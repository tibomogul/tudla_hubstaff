<div data-controller="user-mapping-modal" data-available-users-url="<%= available_tudla_users_users_path %>">
<div class="container mx-auto px-4 py-8">
  <h1 class="text-2xl font-bold mb-6">Unmapped Users</h1>

  <% if @users.any? %>
    <div class="bg-white shadow rounded-lg overflow-hidden">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody id="unmapped-users-list" class="bg-white divide-y divide-gray-200">
          <% @users.each do |user| %>
            <%= render TudlaHubstaff::UserRowComponent.new(user: user) %>
          <% end %>
        </tbody>
      </table>
    </div>

    <%= render TudlaHubstaff::UI::PaginationComponent.new(
      current_page: @current_page,
      total_pages: @total_pages,
      total_count: @total_count,
      path_helper: :unmapped_users_path
    ) %>
  <% else %>
    <div class="text-center py-12">
      <p class="text-gray-500">No unmapped users found.</p>
    </div>
  <% end %>
</div>

<%= render TudlaHubstaff::UI::ModalComponent.new(id: "mapping-modal", stimulus_controller: "user-mapping-modal") do |modal| %>
  <% modal.with_header do %>
    <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4">
      Map User: <span data-user-mapping-modal-target="userName"></span>
    </h3>
  <% end %>

  <% modal.with_body do %>
    <!-- Search Filter -->
    <div class="mb-4">
      <input type="text"
             placeholder="Filter by name..."
             class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
             data-user-mapping-modal-target="searchInput"
             data-action="input->user-mapping-modal#filterUsers">
    </div>

    <!-- Users List -->
    <div class="max-h-80 overflow-y-auto">
      <div data-user-mapping-modal-target="usersList" class="space-y-2">
        <!-- Users will be loaded here -->
      </div>
      <div data-user-mapping-modal-target="loading" class="hidden text-center py-4">
        <span class="text-gray-500">Loading...</span>
      </div>
    </div>

    <!-- Modal Pagination -->
    <div data-user-mapping-modal-target="pagination" class="flex justify-between items-center mt-4 pt-4 border-t border-gray-200">
    </div>
  <% end %>

  <% modal.with_footer do %>
    <button type="button"
            class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto"
            data-action="click->user-mapping-modal#close">
      Cancel
    </button>
  <% end %>
<% end %>
</div>
