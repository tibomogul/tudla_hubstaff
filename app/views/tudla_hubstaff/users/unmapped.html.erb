<div data-controller="user-mapping-modal" data-available-users-url="<%= available_tudla_users_users_path %>">
<div class="container mx-auto px-4 py-8">
  <h1 class="text-2xl font-bold mb-6">Unmapped Users</h1>

  <% if @users.any? %>
    <div class="bg-white shadow rounded-lg overflow-hidden">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
          </tr>
        </thead>
        <tbody id="unmapped-users-list" class="bg-white divide-y divide-gray-200">
          <%= render partial: "user_row", collection: @users, as: :user %>
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <% if @total_pages > 1 %>
      <nav class="flex items-center justify-between border-t border-gray-200 px-4 py-3 sm:px-6 mt-4" aria-label="Pagination">
        <div class="hidden sm:block">
          <p class="text-sm text-gray-700">
            Showing <span class="font-medium"><%= (@current_page - 1) * 20 + 1 %></span> to
            <span class="font-medium"><%= [(@current_page) * 20, @total_count].min %></span> of
            <span class="font-medium"><%= @total_count %></span> results
          </p>
        </div>
        <div class="flex flex-1 justify-between sm:justify-end gap-2">
          <% if @current_page > 1 %>
            <%= link_to "Previous", unmapped_users_path(page: @current_page - 1),
                class: "relative inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50" %>
          <% end %>
          <% if @current_page < @total_pages %>
            <%= link_to "Next", unmapped_users_path(page: @current_page + 1),
                class: "relative inline-flex items-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 ring-1 ring-inset ring-gray-300 hover:bg-gray-50" %>
          <% end %>
        </div>
      </nav>
    <% end %>
  <% else %>
    <div class="text-center py-12">
      <p class="text-gray-500">No unmapped users found.</p>
    </div>
  <% end %>
</div>

<!-- Modal -->
<div id="mapping-modal" 
     class="fixed inset-0 z-50 overflow-y-auto hidden" 
     data-user-mapping-modal-target="modal">
  <!-- Backdrop -->
  <div class="fixed inset-0 bg-black/50 transition-opacity" 
       data-action="click->user-mapping-modal#close"></div>

  <!-- Modal Content -->
  <div class="fixed inset-0 z-10 overflow-y-auto">
    <div class="flex min-h-full items-center justify-center p-4">
      <div class="relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all w-full max-w-lg">
        <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
          <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4">
            Map User: <span data-user-mapping-modal-target="userName"></span>
          </h3>

          <!-- Search Filter -->
          <div class="mb-4">
            <input type="text"
                   placeholder="Filter by name..."
                   class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500"
                   data-user-mapping-modal-target="searchInput"
                   data-action="input->user-mapping-modal#filterUsers">
          </div>

          <!-- Users List -->
          <div class="max-h-80 overflow-y-auto">
            <div data-user-mapping-modal-target="usersList" class="space-y-2">
              <!-- Users will be loaded here -->
            </div>
            <div data-user-mapping-modal-target="loading" class="hidden text-center py-4">
              <span class="text-gray-500">Loading...</span>
            </div>
          </div>

          <!-- Modal Pagination -->
          <div data-user-mapping-modal-target="pagination" class="flex justify-between items-center mt-4 pt-4 border-t border-gray-200">
          </div>
        </div>

        <div class="bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6">
          <button type="button"
                  class="mt-3 inline-flex w-full justify-center rounded-md bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto"
                  data-action="click->user-mapping-modal#close">
            Cancel
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

</div>
